<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ask Question Form</title>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
   
    <div id="root"></div>

   
        </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        
        const root = document.getElementById('root');
      
        const formHTML = `
          <div class="app-container">
            <style>
              /* Your existing CSS styles */
              :root {
                --text-color: #F8F8F8;
                --bg-color: #440d19;
                --card-bg: #352528;
                --input-bg: #2C1C1D;
                --primary-color: #B88147;
                --primary-hover: #D4A36B;
                --border-color: #6B4B3E;
                --editor-toolbar-bg: #352528;
                --editor-button-hover-bg: #6B4B3E;
                --editor-divider: #8D6D5E;
                --error-bg: #9C3333;
                --success-bg: #4CAF50;
                --link-color: #D4AF37;
              }
              body {
                font-family: 'Inter', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                margin: 0;
                padding: 0;
              }
              .app-container {
                min-height: 100vh;
                background-color: var(--bg-color);
                color: var(--text-color);
              }
              .container-bg {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
              }
              .input-style {
                background-color: var(--input-bg);
                color: var(--text-color);
                border: 1px solid var(--border-color);
                transition: border-color 0.2s;
              }
              .input-style:focus {
                border-color: var(--primary-color);
                outline: none;
              }
              .primary-btn {
                background-color: var(--primary-color);
                color: var(--input-bg);
                transition: all 0.2s ease;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
              }
              .primary-btn:hover {
                background-color: var(--primary-hover);
              }
              .editor-toolbar {
                border-bottom: 1px solid var(--border-color);
                background-color: var(--editor-toolbar-bg);
              }
              .editor-button {
                padding: 0.5rem;
                color: var(--text-color);
                transition: background-color 0.1s;
              }
              .editor-button:hover {
                background-color: var(--editor-button-hover-bg);
              }
              .editor-textarea {
                min-height: 250px;
                background-color: var(--input-bg);
                color: var(--text-color);
                resize: vertical;
                padding: 0.75rem;
                line-height: 1.6;
                outline: none;
                border-radius: 0 0 0.5rem 0.5rem;
              }
              .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 100;
                display: flex;
                align-items: center;
                justify-content: center;
              }
              .modal-content {
                background-color: var(--card-bg);
                max-width: 90%;
                width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                position: relative;
              }
              .text-link {
                color: var(--link-color);
              }
              .text-error {
                background-color: var(--error-bg);
                color: var(--text-color);
              }
              .text-success {
                background-color: var(--success-bg);
                color: var(--text-color);
              }
              select.input-style {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath fill='%23F8F8F8' d='M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 0.7em top 50%;
                background-size: 0.8em auto;
                padding-right: 2.5rem;
              }
            </style>

            <!-- Navbar -->
            <header class="w-full bg-transparent p-4 border-b border-gray-600">
              <div class="max-w-7xl mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">BrainstormHQ</h1>
                <nav class="space-x-4 flex items-center">
                  <a href="homepage.html" class="text-gray-300 hover:text-white">Home</a>
                  <a href="#" class="text-yellow-500 font-medium">Ask</a>
                  <button class="primary-btn py-2 px-6 rounded-full text-base font-semibold">Logout</button>
                </nav>
              </div>
            </header>

            <!-- Main Form -->
            <main class="max-w-6xl mx-auto p-4 md:p-8">
              <form id="questionForm" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Form -->
                <div class="lg:col-span-2 space-y-6">
                  <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-bold">Ask a Question</h2>
                    <button type="button" id="helpButton" class="text-gray-300 hover:text-yellow-500 p-2 rounded-full">
                      <i class="fas fa-question-circle text-2xl"></i>
                    </button>
                  </div>

                  <!-- Status Message -->
                  <div id="formMessage" class="hidden p-3 rounded-lg font-semibold"></div>

                  <!-- Title Input -->
                  <div class="space-y-2">
                    <label for="title" class="text-lg font-semibold block">
                      Title<span class="text-red-400">*</span>
                    </label>
                    <p class="text-sm text-gray-400">
                      Be specific and imagine you're asking a question to another person. Min 15 characters. (Current: <span id="titleCount">0</span>)
                    </p>
                    <input
                      type="text"
                      id="title"
                      name="title"
                      class="w-full p-3 rounded-lg input-style focus:ring-2 focus:ring-yellow-500"
                      required
                      minlength="15"
                    />
                  </div>

                  <!-- Body Input -->
                  <div class="space-y-2">
                    <label for="body" class="text-lg font-semibold block">
                      Body<span class="text-red-400">*</span>
                    </label>
                    <p class="text-sm text-gray-400">
                      Include all the information someone would need to answer your question. Min 220 characters. (Current: <span id="bodyCount">36</span>)
                    </p>
                    <div class="container-bg rounded-lg shadow-xl overflow-hidden p-0">
                      <textarea
                        id="body"
                        name="body"
                        class="w-full p-3 rounded-lg input-style min-h-64 editor-textarea"
                        required
                        minlength="220"
                        placeholder="Start drafting your question here..."
                      ></textarea>
                    </div>
                  </div>

                  <!-- Dropdowns -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Subject Tag Dropdown -->
                    <div class="space-y-2">
                      <label for="tags" class="text-lg font-semibold block">
                        Subject Tags<span class="text-red-400">*</span>
                      </label>
                      <select
                        id="tags"
                        name="tag_id"
                        class="w-full p-3 rounded-lg input-style focus:ring-2 focus:ring-yellow-500"
                        required
                      >
                        <option value="" disabled selected>Loading domains...</option>
                      </select>
                    </div>

                    <!-- Level Dropdown -->
                    <div class="space-y-2">
                      <label for="level" class="text-lg font-semibold block">
                        Question Level<span class="text-red-400">*</span>
                      </label>
                      <select
                        id="level"
                        name="level_id"
                        class="w-full p-3 rounded-lg input-style focus:ring-2 focus:ring-yellow-500"
                        required
                      >
                        <option value="" disabled selected>Loading levels...</option>
                      </select>
                    </div>
                  </div>

                  <div class="pt-4">
                    <button
                      type="submit"
                      class="primary-btn py-3 px-8 rounded-full text-lg font-bold w-full md:w-auto"
                    >
                      Post Your Question
                    </button>
                  </div>
                </div>

                <!-- Right Column: Quick Guide -->
                <div class="lg:col-span-1 hidden lg:block">
                  <div class="container-bg p-6 rounded-lg sticky top-8">
                    <h3 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">Quick Guide</h3>
                    <p class="text-gray-400">
                      Use the <i class="fas fa-question-circle"></i> button for detailed steps on drafting a great question!
                    </p>
                    <ul class="mt-4 space-y-2 text-sm text-gray-400">
                      <li>Ensure a descriptive Title.</li>
                      <li>Provide enough Context in the body.</li>
                      <li>Select the appropriate Subject and Level.</li>
                    </ul>
                  </div>
                </div>
              </form>
            </main>

            <!-- Help Modal -->
            <div id="helpModal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center">
              <div class="bg-gray-800 p-8 rounded-xl shadow-2xl max-w-2xl w-full mx-4 relative">
                <h3 class="text-2xl font-bold mb-4">How to Draft a Great Question</h3>
                <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
                <p class="text-gray-300 mb-6">Our community thrives on clear, specific questions. Follow these steps:</p>
                <!-- Your modal content here -->
                <div class="space-y-4">
                  <div class="p-4 rounded-lg bg-gray-700">
                    <h4 class="font-semibold text-lg text-yellow-500 mb-1">1. Clearly Summarize the Problem</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-300 ml-4">
                      <li>Goal: What exactly are you trying to achieve?</li>
                      <li>Output: Describe the result you expect versus what you are actually getting.</li>
                      <li>Errors: Include any error codes, tracebacks, or unexpected behavior.</li>
                    </ul>
                  </div>
                  <div class="p-4 rounded-lg bg-gray-700">
                    <h4 class="font-semibold text-lg text-yellow-500 mb-1">2. Describe What You've Attempted</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-300 ml-4">
                      <li>Show specific pieces of code or steps you've tried.</li>
                      <li>Explain why those attempts failed or didn't meet your goal.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        root.innerHTML = formHTML;

        const form = document.getElementById('questionForm');
        const formMessage = document.getElementById('formMessage');
        const titleInput = document.getElementById('title');
        const titleCount = document.getElementById('titleCount');
        const bodyInput = document.getElementById('body');
        const bodyCount = document.getElementById('bodyCount');
        const tagsSelect = document.getElementById('tags');
        const levelSelect = document.getElementById('level');
        const helpButton = document.getElementById('helpButton');
        const helpModal = document.getElementById('helpModal');
        const closeModal = document.getElementById('closeModal');

        titleInput.addEventListener('input', function() {
          titleCount.textContent = this.value.length;
        });

        bodyInput.addEventListener('input', function() {
          bodyCount.textContent = this.value.length;
        });

        async function loadDropdownData() {
          try {
            console.log("Loading dropdown data");
            
            const domainsResponse = await fetch('http://localhost:4000/api/questions/domains');
            if (!domainsResponse.ok) throw new Error('Domains API failed');
            const domainsData = await domainsResponse.json();
            
            tagsSelect.innerHTML = '<option value="" disabled selected>Select domain</option>';
            domainsData.forEach(tag => {
              const option = document.createElement('option');
              option.value = tag.id;
              option.textContent = tag.name;
              tagsSelect.appendChild(option);
            });

            console.log("Domains loaded:", domainsData);

            // Load levels from your API
            const levelsResponse = await fetch('http://localhost:4000/api/questions/levels');
            if (!levelsResponse.ok) throw new Error('Levels API failed');
            const levelsData = await levelsResponse.json();
            
            levelSelect.innerHTML = '<option value="" disabled selected>Select Difficulty</option>';
            levelsData.forEach(level => {
              const option = document.createElement('option');
              option.value = level.id;
              option.textContent = level.name;
              levelSelect.appendChild(option);
            });

            console.log("Levels loaded:", levelsData);

          } catch (error) {
            console.error('Error loading dropdown data:', error);
            showMessage('error', 'Failed to load form options. Please refresh the page.');
          }
        }

        // Form submission
        form.addEventListener('submit', async function(e) {
          e.preventDefault();

          const formData = {
            title: titleInput.value,
            body_html: bodyInput.value,
            tag_id: parseInt(tagsSelect.value),
            level_id: `level ${levelSelect.value}`,
            owner: 1
          };

          console.log("ðŸŸ¡ Submitting:", formData);

          // Validation
          if (formData.title.length < 15) {
            showMessage('error', 'The title must be at least 15 characters long.');
            return;
          }

          if (formData.body_html.length < 220) {
            showMessage('error', 'The body must contain at least 220 characters of visible text.');
            return;
          }

          if (!formData.tag_id || !formData.level_id) {
            showMessage('error', 'Please select both a Subject Tag and a Question Level.');
            return;
          }

          try {
            const response = await fetch('http://localhost:4000/api/questions', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });

            const data = await response.json();
            console.log("ðŸŸ¡ Server response:", data);

            if (response.ok) {
              showMessage('success', data.message || 'Question posted successfully!');
              form.reset();
              titleCount.textContent = '0';
              bodyCount.textContent = '36';
            } else {
              showMessage('error', data.message || 'Error posting question');
            }
          } catch (error) {
            console.error('Submission error:', error);
            showMessage('error', 'Network error. Please try again.');
          }
        });

        // Modal handlers
        helpButton.addEventListener('click', () => helpModal.classList.remove('hidden'));
        closeModal.addEventListener('click', () => helpModal.classList.add('hidden'));
        helpModal.addEventListener('click', (e) => {
          if (e.target === helpModal) helpModal.classList.add('hidden');
        });

        // Helper function to show messages
        function showMessage(type, text) {
          formMessage.textContent = text;
          formMessage.className = `p-3 rounded-lg font-semibold ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
          formMessage.classList.remove('hidden');
        }

        // Initialize
        loadDropdownData();
      });
    </script>
</body>
</html>